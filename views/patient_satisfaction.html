<!doctype html>
<html lang="en">

<head>
  <!-- Required meta tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <title>Patient Satisfaction Survey</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css"
    integrity="sha384-xOolHFLEh07PJGoPkLv1IbcEPTNtaed2xpHsD9ESMhqIYd0nLMwNLD69Npy4HI+N" crossorigin="anonymous">
  <style>
    html,
    body {
      height: 100%;
      margin: 0;
    }

    body {
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      font-family: sans-serif;
      text-align: center;
      background-color: #fafafa;
    }

    #surveyContent {
      display: flex;
      flex-direction: column;
      align-items: center;
      /* spacing between heading and buttons */
      gap: 5rem;
    }

    h1 {
      margin: 0;
      font-size: 4rem;
      font-weight: 700;
      line-height: 1.4;
    }

    .btn {
      background: none;
      border: none;
      cursor: pointer;
      /* horizontal spacing between buttons */
      margin: 0 1rem;
      transition: transform 0.2s ease;
    }

    .btn svg {
      width: 200px;
      height: 200px;
    }

    #output {
      /* space between survey and output */
      margin-top: 3rem;
      font-size: 2rem;
    }

    #output h5 {
      margin-bottom: 1rem;
      font-size: 3rem;
      font-weight: 700;
    }
  </style>
</head>

<body>
  <div id="surveyContent">
    <h1>How was your visit today?</h1>
    <div>
      <button type="button" class="btn" onclick="submitResponse(1)">
        <svg xmlns="http://www.w3.org/2000/svg" width="128" height="128" viewBox="0 0 128 128" role="img"
          aria-labelledby="happyTitle">
          <title id="happyTitle">Happy</title>
          <circle cx="64" cy="64" r="60" fill="#4CAF50" />
          <!-- eyes -->
          <circle cx="46" cy="50" r="6" fill="#333333" />
          <circle cx="82" cy="50" r="6" fill="#333333" />
          <!-- smile -->
          <path d="M42,78 C42,78 64,100 86,78" fill="none" stroke="#333333" stroke-width="6" stroke-linecap="round"
            stroke-linejoin="round" />
        </svg>
      </button>
      <button type="button" class="btn" onclick="submitResponse(2)">
        <svg xmlns="http://www.w3.org/2000/svg" width="128" height="128" viewBox="0 0 128 128" role="img"
          aria-labelledby="neutralTitle">
          <title id="neutralTitle">Neutral</title>
          <circle cx="64" cy="64" r="60" fill="#FFEB3B" />
          <!-- eyes -->
          <circle cx="46" cy="50" r="6" fill="#333333" />
          <circle cx="82" cy="50" r="6" fill="#333333" />
          <!-- straight mouth -->
          <rect x="40" y="78" width="48" height="6" rx="3" fill="#333333" />
        </svg>
      </button>
      <button type="button" class="btn" onclick="submitResponse(3)">
        <svg xmlns="http://www.w3.org/2000/svg" width="128" height="128" viewBox="0 0 128 128" role="img"
          aria-labelledby="sadTitle">
          <title id="sadTitle">Sad</title>
          <circle cx="64" cy="64" r="60" fill="#F44336" />
          <!-- eyes -->
          <circle cx="46" cy="50" r="6" fill="#333333" />
          <circle cx="82" cy="50" r="6" fill="#333333" />
          <!-- frown -->
          <path d="M42,86 C42,86 64,64 86,86" fill="none" stroke="#333333" stroke-width="6" stroke-linecap="round"
            stroke-linejoin="round" />
        </svg>
      </button>
    </div>
  </div>

  <div id="output" style="display: none;">
    <h5 id="outputTitle"></h5>
    <div id="outputBody"></div>
  </div>

  <script>
    const questionId = 1;

    async function submitResponse(responseValue) {
      const output = document.getElementById('output');
      const outputTitle = document.getElementById('outputTitle');
      const outputBody = document.getElementById('outputBody');
      const surveyContent = document.getElementById('surveyContent')
      surveyContent.style.display = 'none';
      output.style.display = 'block';

      try {
        const res = await fetch('/api/responses', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            question_id: questionId,
            response: responseValue
          })
        });

        if (res.ok) {
          outputTitle.textContent = 'Your response has been submitted';
          outputBody.textContent = 'Thanks for your feedback!';
        } else {
          const error = await res.json();
          outputTitle.textContent = 'Failed to submit response';
          outputBody.textContent = 'Please try again';
        }
      } catch (err) {
        outputTitle.textContent = 'Failed to submit response';
        outputBody.textContent = 'Please try again';
      }

      setTimeout(() => {
        output.style.display = 'none';
        surveyContent.style.display = 'flex';
      }, 3000);
    }

  </script>
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js"
    integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj"
    crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-Fy6S3B9q64WdZWQUiU+q4/2Lc9npb8tCaSX9FK7E8HnRr0Jz8D6OP9dO5Vg3Q9ct"
    crossorigin="anonymous"></script>
</body>

</html>